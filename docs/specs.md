#　注意事項以下の仕様はマークダウン記法で記述する
- 見出しレベルは # から始まり、レベルに応じて # の数を増やす
- 箇条書きは - で始める
- 強調したい部分は ** で囲む
- コードブロックは ```（バッククォート3つ）で囲む
- 日本語の仕様書として見やすく、適切な行間を入れる
- 階層構造がわかりやすいよう、小見出しと本文の字下げを適切に行う」
- github https://github.com/doronpa530/deal-tracker.git



# Amazon・楽天セール通知サービス - 拡張版プロジェクト仕様書

## 1. プロジェクト概要

### 1.1 目的
- Amazon・楽天の商品価格を自動で追跡し、大幅値下げ時に通知するサービスを構築する
- 複数のプラットフォーム（Web、Twitter）で通知を提供する
- アフィリエイトリンク経由の売上でマネタイズする
- 長期的な価格データを活用した高付加価値情報を提供する

### 1.2 目標収益
- 初期: 日500円（月15,000円）
- 半年後: 日1,000円（月30,000円）
- 1年後: 日3,300円（月100,000円）

### 1.3 予算
- 初期開発: 無料（既存の無料サービスを最大限活用）
- 運用コスト: 月1,000円以内
- 収益が月1,000円に達するまで追加投資を最小限に抑える

## 2. システム構成【修正】

### 2.1 全体アーキテクチャ
1. **情報収集システム**: Python スクリプト
2. **データベース**: SQLite（初期）/ PostgreSQL（拡張時）
3. **Webサイト**: Flask + Bootstrap【変更】
4. **通知システム**: Twitter Bot（主要通知チャネル）

### 2.2 システム連携図
```
情報収集システム（Python）
│
├── データベース（SQLite/PostgreSQL）
│     │
│     ├── Webサイト（Flask）──→ サーバー ──→ ユーザー【変更】
│     │
│     └── Twitter Bot ───────→ Twitter ───────→ ユーザー
```

### 2.3 開発環境【修正】
- **OS**: Windows / WSL
- **言語**: Python 3.13+
- **フレームワーク**: Flask, Bootstrap【変更】
- **バージョン管理**: Git, GitHub
- **パッケージ管理**: pip, venv
- **エディタ**: VS Code
- **ホスティング**: PythonAnywhere/Heroku/Render（初期）【変更】

## 3. 各コンポーネントの仕様（更新）

### 3.1 情報収集システム（Python）

#### 3.1.1 機能
- Amazon・楽天の商品ページをスクレイピングして価格を取得
- 通常価格と比較して値下げ率を計算
- 設定した閾値（デフォルト20%）以上の値下げを検出して通知
- 商品情報と価格履歴をデータベースに保存
- 長期的な価格推移を分析し「買い時スコア」を算出

#### 3.1.2 価格比較ロジック（拡張版）
- **絶対的比較**: 設定された通常価格との比較
- **相対的比較**: 過去1週間・1ヶ月・3ヶ月・1年の最安値との比較
- **季節比較**: 昨年同時期の価格との比較
- **類似商品比較**: 同カテゴリー内での相対的な価格優位性

#### 3.1.3 実装詳細
- **使用技術**: Python 3.13+, BeautifulSoup4, Requests, Pandas, SQLAlchemy
- **スクレイピング間隔**: 3時間ごと（サーバー負荷と規約に配慮）
- **対象商品管理**: データベースで管理
- **デプロイ方法**: GitHub ActionsまたはPythonAnywhere

#### 3.1.4 エラー処理と復旧プロセス
- スクレイピング失敗時の再試行メカニズム（最大3回、指数バックオフ）
- IPブロック対策（ローテーション、遅延導入）
- 失敗ログの記録と管理者通知
- 一時的な障害発生時の自動復旧プロセス

#### 3.1.5 パフォーマンス目標
- 単一商品のスクレイピング処理時間: 5秒以内
- バッチ処理の完了時間: 商品100件あたり10分以内
- CPU/メモリ使用率の最適化（メモリ使用量500MB以下）

### 3.2 データベース（拡張）

#### 3.2.1 データモデル
- **商品テーブル**: 商品ID、名前、URL、カテゴリ、通常価格、最終更新日時、画像URL
- **価格履歴テーブル**: 商品ID、取得日時、価格、割引率
- **通知履歴テーブル**: 通知ID、商品ID、通知日時、価格、割引率、通知内容、通知状態
- **カテゴリテーブル**: カテゴリID、名前、親カテゴリID
- **統計テーブル**: 商品ID、平均価格、最安値、最高値、価格変動頻度

#### 3.2.2 実装詳細
- **初期フェーズ**: SQLite（シンプルで導入コスト低）
- **拡張フェーズ**: PostgreSQL（高度な分析クエリ対応）
- **バックアップ**: 日次自動バックアップ
- **データ保持ポリシー**: 価格履歴は最低1年間保持

### 3.3 Webサイト（Flask + Bootstrap）【変更】

#### 3.3.1 機能
- セール情報の一覧表示
- カテゴリ別・サイト別の絞り込み
- 「買い時スコア」の可視化（グラフ表示）
- 過去の価格推移グラフ表示
- 将来の価格予測情報（可能であれば）
- 検索機能（商品名、カテゴリによる検索）

#### 3.3.2 実装詳細【修正】
- **使用技術**: 
  - **バックエンド**: Flask, SQLAlchemy【変更】
  - **フロントエンド**: Bootstrap 5, Chart.js（グラフ表示）
- **テンプレートエンジン**: Jinja2【追加】
- **コンテンツ更新**: 
  - スクレイピング後にデータベース更新
  - サイトは動的にデータベースから最新情報を表示【変更】
- **SEO対策**: メタタグ最適化、構造化データ
- **UI/UX**: レスポンシブデザイン、モバイルファースト設計

#### 3.3.3 パフォーマンス目標
- ページロード時間: 2秒以内（モバイル含む）
- Google PageSpeed Insights スコア: 90以上
- ファーストコンテンツペイント: 1秒以内

#### 3.3.4 商品画像の取り扱い
- 画像は直接キャッシュせず、公式サイトの画像URLを利用
- 必要に応じてlazy loading実装
- 画像URLが無効な場合のフォールバック表示対応
- 画像サイズの最適化（特に一覧表示用）

### 3.4 Twitter Bot

#### 3.4.1 機能
- セール情報の自動ツイート
- 「買い時スコア」を含んだ付加価値情報の提供
- 定期的な宣伝ツイート
- ユーザーからのリプライに対応

#### 3.4.2 実装詳細【修正】
- **使用技術**: 
  - **API連携**: Python, Tweepy（Twitter API v2対応）
  - **ブラウザ自動化**: Selenium, Chrome WebDriver【追加】
- **ツイート頻度**: 
  - セール発見時: リアルタイム
  - 定期ツイート: 10時、15時、20時
- **ツイート内容**: 商品名、現在価格、割引率、買い時スコア、アフィリエイトリンク
- **投稿方法**:【追加】
  - **主要方法**: Twitter API v2（OAuth 2.0認証）
  - **フォールバック方法**: Seleniumによるブラウザ自動操作
  - **切替条件**: API制限到達時または認証エラー発生時に自動切替

#### 3.4.3 Twitter戦略
- ハッシュタグ最適化: #タイムセール #特価情報 #セール #買い時 など
- フォロワー増加施策: 関連アカウントとの相互フォロー、定期的なエンゲージメント
- エンゲージメント向上: 質問形式のツイート、ポール機能の活用
- アナリティクスの定期的なレビューと戦略調整

#### 3.4.4 Seleniumによる自動投稿【新規追加】
- **動作環境**: Chrome/Chromium + WebDriver
- **認証処理**: Cookieベースのセッション管理
- **投稿プロセス**:
  1. ヘッドレスブラウザ起動
  2. Twitter認証（Cookieを使用）
  3. 投稿フォーム操作
  4. メディア添付（商品画像など）
  5. 投稿実行
  6. 結果確認
- **エラー処理**:
  - CAPTCHAなどの検出と一時待機
  - ブラウザのステルス設定
  - エラー時の再試行ロジック
- **リスク対策**:
  - 投稿間隔の調整（最小15分）
  - ブラウザフィンガープリント対策
  - ログイン頻度の最小化（Cookie再利用）

### 3.4.5 デプロイ設定【新規追加】
- **Chrome/WebDriverインストール**: サーバーへの自動インストールスクリプト
- **X（Twitter）アカウント管理**: 複数アカウントの設定と切り替え
- **監視システム**: 投稿失敗時の自動アラート
- **リソース管理**: メモリ使用量の最適化（ブラウザプロセス制御）

### 3.5 管理システム（新規追加）
#### 3.5.1 管理画面の基本機能

- ダッシュボード: 全体的な稼働状況の可視化
- スクレイパー管理: スクレイピングの設定と制御
- Twitter連携管理: Twitter通知の設定と監視
- 商品管理: 追跡商品の追加・編集・削除
- システム設定: 全体パラメータの設定

#### 3.5.2 スクレイパー管理機能

- ステータス監視: スクレイパーの稼働状況リアルタイム表示
- 手動実行/停止: 各サイト（Amazon/楽天）のスクレイパーを個別に制御
- スケジュール設定: 実行時間帯・頻度のカスタマイズ
- パラメータ設定:
  - 対象カテゴリー設定
  - 価格帯フィルター設定
  - リクエスト間隔調整
  - User-Agent設定
- エラー監視: スクレイピングエラーの集計と詳細表示
- ログ表示: 直近のスクレイピング結果のリアルタイム表示

#### 3.5.3 実装詳細

- 使用技術: Flask, Bootstrap, AJAX, WebSocket（リアルタイム更新用）
- 認証: 管理者アカウントによる保護（Basic認証）
- プロセス管理: サブプロセスとスレッドによるスクレイパー制御
- 設定保存: JSON形式の設定ファイル

#### 3.5.4 セキュリティ対策

- アクセス制限: IP制限と強力なパスワード認証
- CSRF対策: トークンによるクロスサイトリクエストフォージェリ対策
- 入力検証: すべての管理設定の適切な検証とサニタイズ
- ログ管理: 管理操作の詳細ログの保存



## 4. 収益化戦略（詳細版）

### 4.1 アフィリエイトプログラム最適化
- **Amazon**: Amazonアソシエイト（紹介料率3〜10%）
  - 高単価・高マージン商品の優先表示
  - Amazonタイムセールとの連携強化
- **楽天**: 楽天アフィリエイト（紹介料率1〜5%）
  - 楽天スーパーセール情報の先行提供
  - 楽天ポイント還元率情報の追加
- **A8.net**: 高単価案件に特化
  - サブスクリプションサービス紹介（継続報酬型）
  - 金融・保険商品など高単価案件

### 4.2 具体的な収益試算
- **Amazonアフィリエイト**: 
  - 平均単価10,000円 × 成約率2% × 紹介料3% × クリック100回/日 = 60円/日
- **楽天アフィリエイト**: 
  - 平均単価8,000円 × 成約率3% × 紹介料4% × クリック80回/日 = 76.8円/日
- **A8.net特定案件**: 
  - 成約単価1,500円 × 成約率1% × クリック25回/日 = 375円/日
- **合計**: 約511.8円/日（月15,354円）

### 4.3 収益向上施策
- **買い時スコアによる信頼性向上**: 成約率を0.5%向上させる効果
- **季節商品の先行情報提供**: 高単価季節商品（エアコンなど）での収益増
- **限定セール情報の早期提供**: タイムセール開始直後の通知による競合差別化
- **ターゲットユーザー拡大**: Twitter フォロワー増加策（ハッシュタグ最適化、相互フォロー）

### 4.4 アフィリエイトリンクのUI実装戦略
- **商品詳細ページ**:
  - ページ上部に目立つCTAボタン配置
  - 商品説明の中にコンテキストに合わせたリンク設置
  - ページ下部に再度CTAボタン配置
- **一覧ページ**:
  - 各商品カードに「詳細を見る」ボタン
  - 「一括比較」ボタンで複数商品の公式サイトを別タブで開く機能
- **最適化**:
  - A/Bテストによるボタンデザイン・文言の最適化
  - ユーザー行動分析に基づく配置調整

## 5. データ活用戦略

### 5.1 「買い時スコア」アルゴリズム
- 過去の最安値との比較（配点40%）
- 季節変動パターンとの一致度（配点30%）
- 将来値下げ予測との関連性（配点20%）
- 類似商品との価格比較（配点10%）

### 5.2 価格予測モデル（将来拡張）
- 過去の価格変動パターンを機械学習で分析
- 季節性・イベント（Prime Day等）を考慮した予測
- 「〇日待つと△円下がる可能性が高い」などの情報提供

### 5.3 データ資産の蓄積方針
- 最低1年分のデータを維持
- 10,000商品以上のデータを目標
- カテゴリ別の価格変動パターンの分析

### 5.4 データ更新サイクル
- スクレイピング: 3時間ごと実行
- Webサイト更新: スクレイピング完了後30分以内に反映
- 買い時スコア再計算: 1日1回（深夜）
- 長期傾向分析: 週1回実行

## 6. 法的考慮事項とセキュリティ

### 6.1 法的考慮事項
- **スクレイピングポリシー遵守**:
  - Amazonと楽天のrobots.txtとAPI利用規約の厳守
  - 適切なUser-Agent設定と過度なリクエスト抑制
- **プライバシーポリシー**:
  - ユーザーデータ収集・利用に関する明確な説明
  - Cookieの使用目的と範囲の明示
- **免責事項**:
  - 価格情報の正確性に関する免責
  - 「買い時スコア」はあくまで参考情報である旨の明示

### 6.2 セキュリティ対策
- **データセキュリティ**:
  - アフィリエイトIDなど機密情報の適切な管理
  - データバックアップの暗号化
- **Webサイトセキュリティ**:
  - HTTPS通信の確保
  - クロスサイトスクリプティング対策
- **自動化リスク対策**:
  - Twitterアカウント凍結防止のためのツイート頻度制限
  - スクレイピングブロック対策（リクエスト間隔の調整）

## 7. フォルダ・ファイル構造

```
~/mysite/                         # PythonAnywhereのホームディレクトリ
└── deal-tracker/                 # プロジェクトルートディレクトリ
    ├── app.py                    # Flaskアプリケーションメイン
    ├── admin_routes.py           # 管理者ルート
    ├── config.py                 # 設定ファイル（環境変数なし）
    ├── .env                      # 環境変数（ローカル開発用）
    ├── requirements.txt          # 依存パッケージ
    ├── README.md                 # ドキュメント
    ├── static/                   # 静的ファイル
    │   ├── css/                  # CSSファイル
    │   ├── js/                   # JavaScriptファイル
    │   └── images/               # 画像ファイル
    ├── templates/                # Flaskテンプレート
    │   ├── index.html            # トップページ
    │   ├── 404.html              # エラーページ
    │   ├── admin/                # 管理画面テンプレート
    │   │   ├── index.html        # 管理ダッシュボード
    │   │   ├── login.html        # 管理ログイン
    │   │   ├── scraper/          # スクレイパー管理画面
    │   │   │   ├── dashboard.html  # スクレイパーダッシュボード
    │   │   │   └── settings.html   # スクレイパー設定
    │   │   └── twitter/          # Twitter管理画面
    │   │       ├── dashboard.html  # Twitterダッシュボード
    │   │       └── settings.html   # Twitter設定
    │   ├── products/             # 商品関連テンプレート
    │   ├── amazon/               # Amazon関連テンプレート
    │   └── rakuten/              # 楽天関連テンプレート
    ├── scraper/                  # スクレイピング関連
    │   ├── db_models.py          # データベースモデル
    │   ├── scraper.py            # スクレイピングメインコード
    │   ├── twitter_bot.py        # Twitter連携コード
    │   ├── twitter_selenium.py   # Seleniumによる投稿機能
    │   ├── browser_utils.py      # ブラウザ設定ユーティリティ
    │   ├── utils.py              # ユーティリティ関数
    │   ├── scrape_amazon.py      # Amazon専用スクレイパー
    │   ├── scrape_rakuten.py     # 楽天専用スクレイパー
    │   └── scraper_config.json   # スクレイパー設定ファイル
    ├── database/                 # データベース関連
    │   └── deal_tracker.db       # SQLiteデータベースファイル（開発用）
    └── logs/                     # ログファイル
        ├── app.log               # アプリケーションログ
        ├── scraper.log           # スクレイピングログ
        └── error.log             # エラーログ
```

## 8. サイト構造設計（サイトマップ）

### 8.1 ページ構成
- **トップページ**（`/`）
  - 最新の特価情報
  - サービスの簡単な説明
  - 買い時スコアの上位商品
  - Twitterアカウントへのリンク

- **Amazon特価**（`/amazon/`）
  - Amazon商品の一覧表示
  - 最新の特価情報を中心に表示
  - フィルタリング機能（割引率順、買い時スコア順）

- **楽天特価**（`/rakuten/`）
  - 楽天商品の一覧表示
  - 最新の特価情報を中心に表示
  - フィルタリング機能（割引率順、買い時スコア順）

- **カテゴリー一覧**（`/categories/`）
  - 家電
  - パソコン・周辺機器
  - キッチン用品
  - 生活雑貨
  - ファッション
  - その他主要カテゴリー

- **商品個別ページ**（`/products/amazon/[商品ID].html`または`/products/rakuten/[商品ID].html`）
  - 商品名と画像
  - 現在価格と通常価格
  - 割引率
  - 買い時スコアと解説
  - 価格推移グラフ（実装予定）
  - 商品購入リンク（アフィリエイトリンク）

- **サイトについて**（`/about/`）
  - サービス概要
  - 買い時スコアの仕組み
  - 運営者情報
  - お問い合わせ方法（Twitter）

### 8.2 将来拡張予定ページ
- **お気に入り**（`/favorites/`）
  - ユーザーがお気に入り登録した商品一覧（Cookieベース）
  - 価格変動通知設定

- **価格予測**（`/predictions/`）
  - AIによる価格予測情報
  - セール時期の予測情報

### 8.3 共通要素
1. ヘッダー：サイト名、メインメニュー
2. フッター：簡単な著作権表示、Twitter連携
3. サイドバー：カテゴリー一覧、人気商品

### 8.4 実装優先順位
1. 基本構造とデザイン
2. 商品一覧と詳細表示
3. カテゴリー分類
4. 価格推移グラフなどの付加機能

## 9. 実装・運用スケジュール【修正】

### 9.1 フェーズ1: 基盤構築（2週間）
- 開発環境セットアップ
- データベース設計
- 基本スクレイピング機能実装
- Flask基本設定【変更】

### 9.2 フェーズ2: 基本機能実装（2週間）
- Amazonスクレイピング完成
- 基本ルート・テンプレート実装【変更】
- Twitterボット基本機能実装
- デプロイパイプライン設定【変更】
- 管理画面基盤実装【追加】
- デプロイパイプライン設定

### 9.3 フェーズ3: 機能拡張（3週間）
- 楽天スクレイピング実装
- 商品一覧ページ実装
- 買い時スコアアルゴリズム実装
- スクレイパー管理機能の完成【追加】
- SEO対策実施

### 9.4 フェーズ4: UI/UX改善（2週間）
- モバイル対応最適化
- 価格推移グラフ実装
- アフィリエイトリンク最適化
- Twitter管理機能の強化【追加】
- パフォーマンス改善

### 9.5 フェーズ5: 安定運用・マーケティング（継続）
- エラー処理の強化
- ユーザーフィードバック対応
- Twitter宣伝活動
- アクセス解析と改善

## 10. 決定事項と未決定事項【修正】

### 10.1 決定済み事項
- 基本技術スタック: Python, Flask, Bootstrap, SQLite, Twitter API【変更】
- ホスティング: PythonAnywhere/Heroku/Render【変更】
- サイト名: 値下げスカウター【追加】
- ビジネスモデル: アフィリエイト収益
- 収益目標: 日1,000円（月30,000円）

### 10.2 未決定事項（要決定）
- **【要決定】商品選定基準**: 対象とする商品カテゴリーと最低価格帯の決定
- **【要決定】アフィリエイトID管理**: 複数プログラムのID管理方法
- **【要決定】独自ドメイン**: 取得するかどうか、取得する場合の名称
- **【要決定】通知閾値**: デフォルトの値下げ通知閾値（20%が仮設定）
- **【要決定】具体的なホスティングサービス**: PythonAnywhere、Heroku、Renderのどれを使用するか【追加】

### 10.3 将来の検討事項
- サーバー移行: トラフィック増加時の対応策
- 収益化拡大: 追加の収益モデル検討
- ユーザーアカウント: 将来的なユーザー登録機能
- モバイルアプリ対応: PWAまたはネイティブアプリの検討

## 11. 段階的開発プラン【新規追加】

### 11.1 最小実行可能製品（MVP）定義
- トップページ（最新特価商品3-5件表示）
- Amazon特価ページ（リスト表示のみ）
- 商品詳細ページ（基本情報とアフィリエイトリンクのみ）
- 単純なレスポンシブデザイン

### 11.2 段階的機能追加
1. **ステージ1**: 基本機能（1-2週間）
   - 基本的なルーティングとテンプレート
   - データベース連携
   - シンプルな商品表示
   - 基本的な管理画面【追加】

2. **ステージ2**: コア機能（2-3週間）
   - 商品詳細ページの充実
   - カテゴリ分類の実装
   - 買い時スコアの表示
   - スクレイパー管理機能【追加】

3. **ステージ3**: UX向上（2週間）
   - 価格推移グラフ実装
   - フィルタリング・検索機能
   - UI/UXの改善
   - Twitter管理機能【追加】

4. **ステージ4**: 収益最適化（2週間）
   - アフィリエイトリンクの最適化
   - SEO対策の強化
   - パフォーマンスチューニング
   - 管理分析レポート機能【追加】

### 11.3 各ステージでのチェックポイント
- 各ステージの開始時に明確な目標を設定
- ステージ完了時に機能確認と問題点の洗い出し
- 進捗が滞った場合、MVP機能に集中して優先的に完成させる


## 12. 管理システム詳細設計（新規追加）
### 12.1 管理者認証システム

- 管理画面へのアクセス制御
- 管理者アカウント管理
- セッション管理とセキュリティ

### 12.2 スクレイパー管理モジュール

- リアルタイムステータス監視
- 実行スケジュール管理
- パラメータ設定とカスタマイズ
- エラー検知と自動復旧設定

### 12.3 データ分析ダッシュボード

- スクレイピング成功率グラフ
- 価格変動幅の統計データ
- カテゴリー別の値下げ傾向分析
- 時間帯別の価格変動パターン

### 12.4 通知管理システム

- Twitter通知設定（頻度、形式）
- 優先度設定（割引率、買い時スコア閾値）
- 通知履歴と効果分析
- テスト通知機能

### 12.5 管理操作ログ

- すべての管理操作の記録
- エラーログと警告の一元管理
- パフォーマンス指標の計測
- 定期レポート生成

#　注意事項以下の仕様はマークダウン記法で記述する
- 見出しレベルは # から始まり、レベルに応じて # の数を増やす
- 箇条書きは - で始める
- 強調したい部分は ** で囲む
- コードブロックは ```（バッククォート3つ）で囲む
- 日本語の仕様書として見やすく、適切な行間を入れる
- 階層構造がわかりやすいよう、小見出しと本文の字下げを適切に行う」




# Amazon・楽天セール通知サービス - 拡張版プロジェクト仕様書

## 1. プロジェクト概要

### 1.1 目的
- Amazon・楽天の商品価格を自動で追跡し、大幅値下げ時に通知するサービスを構築する
- 複数のプラットフォーム（Web、Twitter）で通知を提供する
- アフィリエイトリンク経由の売上でマネタイズする
- 長期的な価格データを活用した高付加価値情報を提供する

### 1.2 目標収益
- 初期: 日500円（月15,000円）
- 半年後: 日1,000円（月30,000円）
- 1年後: 日3,300円（月100,000円）

### 1.3 予算
- 初期開発: 無料（既存の無料サービスを最大限活用）
- 運用コスト: 月1,000円以内
- 収益が月1,000円に達するまで追加投資を最小限に抑える

## 2. システム構成【修正】

### 2.1 全体アーキテクチャ
1. **情報収集システム**: Python スクリプト
2. **データベース**: SQLite（初期）/ PostgreSQL（拡張時）
3. **Webサイト**: Flask + Bootstrap【変更】
4. **通知システム**: Twitter Bot（主要通知チャネル）

### 2.2 システム連携図
```
情報収集システム（Python）
│
├── データベース（SQLite/PostgreSQL）
│     │
│     ├── Webサイト（Flask）──→ サーバー ──→ ユーザー【変更】
│     │
│     └── Twitter Bot ───────→ Twitter ───────→ ユーザー
```

### 2.3 開発環境【修正】
- **OS**: Windows / WSL
- **言語**: Python 3.13+
- **フレームワーク**: Flask, Bootstrap【変更】
- **バージョン管理**: Git, GitHub
- **パッケージ管理**: pip, venv
- **エディタ**: VS Code
- **ホスティング**: PythonAnywhere/Heroku/Render（初期）【変更】

## 3. 各コンポーネントの仕様（更新）

### 3.1 情報収集システム（Python）

#### 3.1.1 機能
- Amazon・楽天の商品ページをスクレイピングして価格を取得
- 通常価格と比較して値下げ率を計算
- 設定した閾値（デフォルト20%）以上の値下げを検出して通知
- 商品情報と価格履歴をデータベースに保存
- 長期的な価格推移を分析し「買い時スコア」を算出

#### 3.1.2 価格比較ロジック（拡張版）
- **絶対的比較**: 設定された通常価格との比較
- **相対的比較**: 過去1週間・1ヶ月・3ヶ月・1年の最安値との比較
- **季節比較**: 昨年同時期の価格との比較
- **類似商品比較**: 同カテゴリー内での相対的な価格優位性

#### 3.1.3 実装詳細
- **使用技術**: Python 3.13+, BeautifulSoup4, Requests, Pandas, SQLAlchemy
- **スクレイピング間隔**: 3時間ごと（サーバー負荷と規約に配慮）
- **対象商品管理**: データベースで管理
- **デプロイ方法**: GitHub ActionsまたはPythonAnywhere

#### 3.1.4 エラー処理と復旧プロセス
- スクレイピング失敗時の再試行メカニズム（最大3回、指数バックオフ）
- IPブロック対策（ローテーション、遅延導入）
- 失敗ログの記録と管理者通知
- 一時的な障害発生時の自動復旧プロセス

#### 3.1.5 パフォーマンス目標
- 単一商品のスクレイピング処理時間: 5秒以内
- バッチ処理の完了時間: 商品100件あたり10分以内
- CPU/メモリ使用率の最適化（メモリ使用量500MB以下）

### 3.2 データベース（拡張）

#### 3.2.1 データモデル
- **商品テーブル**: 商品ID、名前、URL、カテゴリ、通常価格、最終更新日時、画像URL
- **価格履歴テーブル**: 商品ID、取得日時、価格、割引率
- **通知履歴テーブル**: 通知ID、商品ID、通知日時、価格、割引率、通知内容、通知状態
- **カテゴリテーブル**: カテゴリID、名前、親カテゴリID
- **統計テーブル**: 商品ID、平均価格、最安値、最高値、価格変動頻度

#### 3.2.2 実装詳細
- **初期フェーズ**: SQLite（シンプルで導入コスト低）
- **拡張フェーズ**: PostgreSQL（高度な分析クエリ対応）
- **バックアップ**: 日次自動バックアップ
- **データ保持ポリシー**: 価格履歴は最低1年間保持

### 3.3 Webサイト（Flask + Bootstrap）【変更】

#### 3.3.1 機能
- セール情報の一覧表示
- カテゴリ別・サイト別の絞り込み
- 「買い時スコア」の可視化（グラフ表示）
- 過去の価格推移グラフ表示
- 将来の価格予測情報（可能であれば）
- 検索機能（商品名、カテゴリによる検索）

#### 3.3.2 実装詳細【修正】
- **使用技術**: 
  - **バックエンド**: Flask, SQLAlchemy【変更】
  - **フロントエンド**: Bootstrap 5, Chart.js（グラフ表示）
- **テンプレートエンジン**: Jinja2【追加】
- **コンテンツ更新**: 
  - スクレイピング後にデータベース更新
  - サイトは動的にデータベースから最新情報を表示【変更】
- **SEO対策**: メタタグ最適化、構造化データ
- **UI/UX**: レスポンシブデザイン、モバイルファースト設計

#### 3.3.3 パフォーマンス目標
- ページロード時間: 2秒以内（モバイル含む）
- Google PageSpeed Insights スコア: 90以上
- ファーストコンテンツペイント: 1秒以内

#### 3.3.4 商品画像の取り扱い
- 画像は直接キャッシュせず、公式サイトの画像URLを利用
- 必要に応じてlazy loading実装
- 画像URLが無効な場合のフォールバック表示対応
- 画像サイズの最適化（特に一覧表示用）

### 3.4 Twitter Bot

#### 3.4.1 機能
- セール情報の自動ツイート
- 「買い時スコア」を含んだ付加価値情報の提供
- 定期的な宣伝ツイート
- ユーザーからのリプライに対応

#### 3.4.2 実装詳細
- **使用技術**: Python, Tweepy
- **ツイート頻度**: 
  - セール発見時: リアルタイム
  - 定期ツイート: 10時、15時、20時
- **ツイート内容**: 商品名、現在価格、割引率、買い時スコア、アフィリエイトリンク

#### 3.4.3 Twitter戦略
- ハッシュタグ最適化: #タイムセール #特価情報 #セール #買い時 など
- フォロワー増加施策: 関連アカウントとの相互フォロー、定期的なエンゲージメント
- エンゲージメント向上: 質問形式のツイート、ポール機能の活用
- アナリティクスの定期的なレビューと戦略調整


### 3.5 管理システム（新規追加）
#### 3.5.1 管理画面の基本機能

- ダッシュボード: 全体的な稼働状況の可視化
- スクレイパー管理: スクレイピングの設定と制御
- Twitter連携管理: Twitter通知の設定と監視
- 商品管理: 追跡商品の追加・編集・削除
- システム設定: 全体パラメータの設定

#### 3.5.2 スクレイパー管理機能

- ステータス監視: スクレイパーの稼働状況リアルタイム表示
- 手動実行/停止: 各サイト（Amazon/楽天）のスクレイパーを個別に制御
- スケジュール設定: 実行時間帯・頻度のカスタマイズ
- パラメータ設定:
  - 対象カテゴリー設定
  - 価格帯フィルター設定
  - リクエスト間隔調整
  - User-Agent設定
- エラー監視: スクレイピングエラーの集計と詳細表示
- ログ表示: 直近のスクレイピング結果のリアルタイム表示

#### 3.5.3 実装詳細

- 使用技術: Flask, Bootstrap, AJAX, WebSocket（リアルタイム更新用）
- 認証: 管理者アカウントによる保護（Basic認証）
- プロセス管理: サブプロセスとスレッドによるスクレイパー制御
- 設定保存: JSON形式の設定ファイル

#### 3.5.4 セキュリティ対策

- アクセス制限: IP制限と強力なパスワード認証
- CSRF対策: トークンによるクロスサイトリクエストフォージェリ対策
- 入力検証: すべての管理設定の適切な検証とサニタイズ
- ログ管理: 管理操作の詳細ログの保存



## 4. 収益化戦略（詳細版）

### 4.1 アフィリエイトプログラム最適化
- **Amazon**: Amazonアソシエイト（紹介料率3〜10%）
  - 高単価・高マージン商品の優先表示
  - Amazonタイムセールとの連携強化
- **楽天**: 楽天アフィリエイト（紹介料率1〜5%）
  - 楽天スーパーセール情報の先行提供
  - 楽天ポイント還元率情報の追加
- **A8.net**: 高単価案件に特化
  - サブスクリプションサービス紹介（継続報酬型）
  - 金融・保険商品など高単価案件

### 4.2 具体的な収益試算
- **Amazonアフィリエイト**: 
  - 平均単価10,000円 × 成約率2% × 紹介料3% × クリック100回/日 = 60円/日
- **楽天アフィリエイト**: 
  - 平均単価8,000円 × 成約率3% × 紹介料4% × クリック80回/日 = 76.8円/日
- **A8.net特定案件**: 
  - 成約単価1,500円 × 成約率1% × クリック25回/日 = 375円/日
- **合計**: 約511.8円/日（月15,354円）

### 4.3 収益向上施策
- **買い時スコアによる信頼性向上**: 成約率を0.5%向上させる効果
- **季節商品の先行情報提供**: 高単価季節商品（エアコンなど）での収益増
- **限定セール情報の早期提供**: タイムセール開始直後の通知による競合差別化
- **ターゲットユーザー拡大**: Twitter フォロワー増加策（ハッシュタグ最適化、相互フォロー）

### 4.4 アフィリエイトリンクのUI実装戦略
- **商品詳細ページ**:
  - ページ上部に目立つCTAボタン配置
  - 商品説明の中にコンテキストに合わせたリンク設置
  - ページ下部に再度CTAボタン配置
- **一覧ページ**:
  - 各商品カードに「詳細を見る」ボタン
  - 「一括比較」ボタンで複数商品の公式サイトを別タブで開く機能
- **最適化**:
  - A/Bテストによるボタンデザイン・文言の最適化
  - ユーザー行動分析に基づく配置調整

## 5. データ活用戦略

### 5.1 「買い時スコア」アルゴリズム
- 過去の最安値との比較（配点40%）
- 季節変動パターンとの一致度（配点30%）
- 将来値下げ予測との関連性（配点20%）
- 類似商品との価格比較（配点10%）

### 5.2 価格予測モデル（将来拡張）
- 過去の価格変動パターンを機械学習で分析
- 季節性・イベント（Prime Day等）を考慮した予測
- 「〇日待つと△円下がる可能性が高い」などの情報提供

### 5.3 データ資産の蓄積方針
- 最低1年分のデータを維持
- 10,000商品以上のデータを目標
- カテゴリ別の価格変動パターンの分析

### 5.4 データ更新サイクル
- スクレイピング: 3時間ごと実行
- Webサイト更新: スクレイピング完了後30分以内に反映
- 買い時スコア再計算: 1日1回（深夜）
- 長期傾向分析: 週1回実行

## 6. 法的考慮事項とセキュリティ

### 6.1 法的考慮事項
- **スクレイピングポリシー遵守**:
  - Amazonと楽天のrobots.txtとAPI利用規約の厳守
  - 適切なUser-Agent設定と過度なリクエスト抑制
- **プライバシーポリシー**:
  - ユーザーデータ収集・利用に関する明確な説明
  - Cookieの使用目的と範囲の明示
- **免責事項**:
  - 価格情報の正確性に関する免責
  - 「買い時スコア」はあくまで参考情報である旨の明示

### 6.2 セキュリティ対策
- **データセキュリティ**:
  - アフィリエイトIDなど機密情報の適切な管理
  - データバックアップの暗号化
- **Webサイトセキュリティ**:
  - HTTPS通信の確保
  - クロスサイトスクリプティング対策
- **自動化リスク対策**:
  - Twitterアカウント凍結防止のためのツイート頻度制限
  - スクレイピングブロック対策（リクエスト間隔の調整）

## 7. フォルダ・ファイル構造

```
ddeal-tracker/
├── .github/
│   └── workflows/
│       └── deploy.yml           # デプロイ設定
├── docs/
│   └── ...
├── scraper/
│   ├── __pycache__/             # Pythonキャッシュ
│   ├── requirements.txt         # Pythonパッケージ依存関係
│   ├── scraper.py               # スクレイピングメインコード
│   ├── twitter_bot.py           # Twitter連携コード
│   ├── db_models.py             # データベースモデル
│   ├── utils.py                 # ユーティリティ関数
│   ├── config.py                # 設定ファイル
│   ├── scrape_amazon.py         # Amazon専用スクレイパー【追加】
│   ├── scrape_rakuten.py        # 楽天専用スクレイパー【追加】
│   └── scraper_config.json      # スクレイパー設定ファイル【追加】
├── database/
│   └── deal_tracker.db          # SQLiteデータベースファイル
├── debug/
│   └── amazon_debug*.html       # デバッグ用HTMLファイル
├── webapp/
│   ├── app.py                   # Flaskアプリケーションメイン
│   ├── config.py                # Flask設定
│   ├── models/                  # データモデル
│   │   └── ...
│   ├── routes/                  # ルート定義
│   │   ├── __init__.py
│   │   ├── main.py              # メインルート
│   │   ├── amazon.py            # Amazonルート
│   │   ├── rakuten.py           # 楽天ルート
│   │   ├── api.py               # API用ルート
│   │   ├── admin.py             # 管理画面基本ルート【追加】
│   │   ├── scraper_admin.py     # スクレイパー管理ルート【追加】
│   │   └── twitter_admin.py     # Twitter管理ルート【追加】
│   ├── static/
│   │   └── ...
│   ├── templates/
│   │   ├── ...
│   │   ├── admin/               # 管理画面テンプレート【追加】
│   │   │   ├── index.html       # 管理ダッシュボード【追加】
│   │   │   ├── login.html       # 管理ログイン【追加】
│   │   │   ├── scraper/         # スクレイパー管理画面【追加】
│   │   │   │   ├── dashboard.html  # スクレイパーダッシュボード
│   │   │   │   └── settings.html   # スクレイパー設定
│   │   │   └── twitter/         # Twitter管理画面
│   │   │       ├── dashboard.html  # Twitterダッシュボード
│   │   │       └── settings.html   # Twitter設定
│   ├── utils/
│   │   └── ...
│   ├── requirements.txt
│   └── wsgi.py
├── venv/
└── README.md
```

## 8. サイト構造設計（サイトマップ）

### 8.1 ページ構成
- **トップページ**（`/`）
  - 最新の特価情報
  - サービスの簡単な説明
  - 買い時スコアの上位商品
  - Twitterアカウントへのリンク

- **Amazon特価**（`/amazon/`）
  - Amazon商品の一覧表示
  - 最新の特価情報を中心に表示
  - フィルタリング機能（割引率順、買い時スコア順）

- **楽天特価**（`/rakuten/`）
  - 楽天商品の一覧表示
  - 最新の特価情報を中心に表示
  - フィルタリング機能（割引率順、買い時スコア順）

- **カテゴリー一覧**（`/categories/`）
  - 家電
  - パソコン・周辺機器
  - キッチン用品
  - 生活雑貨
  - ファッション
  - その他主要カテゴリー

- **商品個別ページ**（`/products/amazon/[商品ID].html`または`/products/rakuten/[商品ID].html`）
  - 商品名と画像
  - 現在価格と通常価格
  - 割引率
  - 買い時スコアと解説
  - 価格推移グラフ（実装予定）
  - 商品購入リンク（アフィリエイトリンク）

- **サイトについて**（`/about/`）
  - サービス概要
  - 買い時スコアの仕組み
  - 運営者情報
  - お問い合わせ方法（Twitter）

### 8.2 将来拡張予定ページ
- **お気に入り**（`/favorites/`）
  - ユーザーがお気に入り登録した商品一覧（Cookieベース）
  - 価格変動通知設定

- **価格予測**（`/predictions/`）
  - AIによる価格予測情報
  - セール時期の予測情報

### 8.3 共通要素
1. ヘッダー：サイト名、メインメニュー
2. フッター：簡単な著作権表示、Twitter連携
3. サイドバー：カテゴリー一覧、人気商品

### 8.4 実装優先順位
1. 基本構造とデザイン
2. 商品一覧と詳細表示
3. カテゴリー分類
4. 価格推移グラフなどの付加機能

## 9. 実装・運用スケジュール【修正】

### 9.1 フェーズ1: 基盤構築（2週間）
- 開発環境セットアップ
- データベース設計
- 基本スクレイピング機能実装
- Flask基本設定【変更】

### 9.2 フェーズ2: 基本機能実装（2週間）
- Amazonスクレイピング完成
- 基本ルート・テンプレート実装【変更】
- Twitterボット基本機能実装
- デプロイパイプライン設定【変更】
- 管理画面基盤実装【追加】
- デプロイパイプライン設定

### 9.3 フェーズ3: 機能拡張（3週間）
- 楽天スクレイピング実装
- 商品一覧ページ実装
- 買い時スコアアルゴリズム実装
- スクレイパー管理機能の完成【追加】
- SEO対策実施

### 9.4 フェーズ4: UI/UX改善（2週間）
- モバイル対応最適化
- 価格推移グラフ実装
- アフィリエイトリンク最適化
- Twitter管理機能の強化【追加】
- パフォーマンス改善

### 9.5 フェーズ5: 安定運用・マーケティング（継続）
- エラー処理の強化
- ユーザーフィードバック対応
- Twitter宣伝活動
- アクセス解析と改善

## 10. 決定事項と未決定事項【修正】

### 10.1 決定済み事項
- 基本技術スタック: Python, Flask, Bootstrap, SQLite, Twitter API【変更】
- ホスティング: PythonAnywhere/Heroku/Render【変更】
- サイト名: 値下げスカウター【追加】
- ビジネスモデル: アフィリエイト収益
- 収益目標: 日1,000円（月30,000円）

### 10.2 未決定事項（要決定）
- **【要決定】商品選定基準**: 対象とする商品カテゴリーと最低価格帯の決定
- **【要決定】アフィリエイトID管理**: 複数プログラムのID管理方法
- **【要決定】独自ドメイン**: 取得するかどうか、取得する場合の名称
- **【要決定】通知閾値**: デフォルトの値下げ通知閾値（20%が仮設定）
- **【要決定】具体的なホスティングサービス**: PythonAnywhere、Heroku、Renderのどれを使用するか【追加】

### 10.3 将来の検討事項
- サーバー移行: トラフィック増加時の対応策
- 収益化拡大: 追加の収益モデル検討
- ユーザーアカウント: 将来的なユーザー登録機能
- モバイルアプリ対応: PWAまたはネイティブアプリの検討

## 11. 段階的開発プラン【新規追加】

### 11.1 最小実行可能製品（MVP）定義
- トップページ（最新特価商品3-5件表示）
- Amazon特価ページ（リスト表示のみ）
- 商品詳細ページ（基本情報とアフィリエイトリンクのみ）
- 単純なレスポンシブデザイン

### 11.2 段階的機能追加
1. **ステージ1**: 基本機能（1-2週間）
   - 基本的なルーティングとテンプレート
   - データベース連携
   - シンプルな商品表示
   - 基本的な管理画面【追加】

2. **ステージ2**: コア機能（2-3週間）
   - 商品詳細ページの充実
   - カテゴリ分類の実装
   - 買い時スコアの表示
   - スクレイパー管理機能【追加】

3. **ステージ3**: UX向上（2週間）
   - 価格推移グラフ実装
   - フィルタリング・検索機能
   - UI/UXの改善
   - Twitter管理機能【追加】

4. **ステージ4**: 収益最適化（2週間）
   - アフィリエイトリンクの最適化
   - SEO対策の強化
   - パフォーマンスチューニング
   - 管理分析レポート機能【追加】

### 11.3 各ステージでのチェックポイント
- 各ステージの開始時に明確な目標を設定
- ステージ完了時に機能確認と問題点の洗い出し
- 進捗が滞った場合、MVP機能に集中して優先的に完成させる


## 12. 管理システム詳細設計（新規追加）
### 12.1 管理者認証システム

- 管理画面へのアクセス制御
- 管理者アカウント管理
- セッション管理とセキュリティ

### 12.2 スクレイパー管理モジュール

- リアルタイムステータス監視
- 実行スケジュール管理
- パラメータ設定とカスタマイズ
- エラー検知と自動復旧設定

### 12.3 データ分析ダッシュボード

- スクレイピング成功率グラフ
- 価格変動幅の統計データ
- カテゴリー別の値下げ傾向分析
- 時間帯別の価格変動パターン

### 12.4 通知管理システム

- Twitter通知設定（頻度、形式）
- 優先度設定（割引率、買い時スコア閾値）
- 通知履歴と効果分析
- テスト通知機能

### 12.5 管理操作ログ

- すべての管理操作の記録
- エラーログと警告の一元管理
- パフォーマンス指標の計測
- 定期レポート生成
## 13. スクレイピング詳細仕様【新規追加】

### 13.1 スクレイピング対象
- **Amazon**
  - 人気・売れ筋ランキング（カテゴリー別）
    - 家電
    - パソコン・周辺機器
    - キッチン用品
    - おもちゃ
  - タイムセール商品
  - 特選タイムセール
- **楽天**
  - デイリーランキング（カテゴリー別）
    - 家電
    - パソコン
    - キッチン用品
    - おもちゃ
  - 楽天スーパーセール対象商品
  - タイムセール

### 13.2 スクレイピングタイミング
- **ランキングスクレイピング**: 1日2回（午前10時、午後8時）
- **タイムセールスクレイピング**: 3時間ごと（08:00、11:00、14:00、17:00、20:00、23:00）
- **手動実行**: 管理画面からの指示でいつでも実行可能

### 13.3 スクレイピングロジック
- **Amazonランキング**
  1. カテゴリー別ランキングページにアクセス
  2. 上位100商品の情報（ASIN、名前、URL、現在価格、画像URL）を抽出
  3. 新規商品はデータベースに追加、既存商品は情報を更新
  4. 商品ページに個別アクセスして詳細情報を取得（レビュー数、評価など）

- **Amazonタイムセール**
  1. タイムセールページにアクセス
  2. 全タイムセール商品情報を抽出
  3. 割引率が設定閾値以上の商品を優先的に処理

- **楽天ランキング**
  1. カテゴリー別ランキングページにアクセス
  2. 上位100商品の情報（商品ID、名前、URL、現在価格、画像URL）を抽出
  3. 新規商品はデータベースに追加、既存商品は情報を更新

- **楽天タイムセール**
  1. タイムセールページにアクセス
  2. 全タイムセール商品情報を抽出
  3. 割引率が設定閾値以上の商品を優先的に処理

### 13.4 スクレイピング処理フロー
1. スクレイピング開始（スケジュール/手動）
2. User-Agent設定とリクエストヘッダー準備
3. 対象ページへアクセス（遅延を設定）
4. HTML解析と商品情報抽出
5. データベースと照合（新規/更新判定）
6. 価格変動検知と通知条件チェック
7. 通知対象商品の処理（通知キューに追加）
8. 結果ログの記録
9. スクレイピング完了通知

### 13.5 エラー処理と再試行メカニズム
- **接続エラー時**: 3回まで自動再試行（指数バックオフ方式）
- **解析エラー時**: ページ構造変更検知とアラート発行
- **429エラー(Too Many Requests)**: 待機時間を自動調整して再試行
- **503エラー(Service Unavailable)**: 24時間待機後に再試行

### 13.6 スクレイピング制限と対策
- **リクエスト間隔**: 最小3秒（設定可変）
- **セッション管理**: Cookie管理とセッションローテーション
- **IP制限対策**: プロキシ使用準備（必要に応じて）
- **並列度制限**: 同時リクエスト数を2以下に制限

## 14. データベース詳細設計【新規追加】

### 14.1 データモデル詳細

#### 14.1.1 商品テーブル (items)
- **id**: INTEGER PRIMARY KEY
- **product_id**: VARCHAR(50) NOT NULL（AmazonのASIN、楽天の商品ID）
- **site**: VARCHAR(20) NOT NULL（'amazon'/'rakuten'）
- **name**: VARCHAR(255) NOT NULL
- **url**: VARCHAR(1024) NOT NULL UNIQUE
- **category_id**: INTEGER
- **normal_price**: FLOAT NOT NULL
- **current_price**: FLOAT
- **image_url**: VARCHAR(1024)
- **description**: TEXT
- **rank**: INTEGER（ランキング情報、該当しない場合はNULL）
- **rating**: FLOAT（評価、5段階）
- **review_count**: INTEGER
- **data_source**: VARCHAR(50)（'ranking'/'timesale'/'manual'）
- **active**: BOOLEAN DEFAULT TRUE
- **created_at**: DATETIME DEFAULT CURRENT_TIMESTAMP
- **updated_at**: DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP

#### 14.1.2 価格履歴テーブル (price_histories)
- **id**: INTEGER PRIMARY KEY
- **item_id**: INTEGER REFERENCES items(id)
- **price**: FLOAT NOT NULL
- **discount_rate**: FLOAT
- **timestamp**: DATETIME DEFAULT CURRENT_TIMESTAMP
- **INDEX**: (item_id, timestamp)

#### 14.1.3 通知履歴テーブル (notifications)
- **id**: INTEGER PRIMARY KEY
- **item_id**: INTEGER REFERENCES items(id)
- **price**: FLOAT NOT NULL
- **discount_rate**: FLOAT NOT NULL
- **buy_score**: INTEGER
- **message**: TEXT NOT NULL
- **tweeted**: BOOLEAN DEFAULT FALSE
- **web_displayed**: BOOLEAN DEFAULT FALSE
- **notification_type**: VARCHAR(20)（'twitter'/'web'/'both'）
- **timestamp**: DATETIME DEFAULT CURRENT_TIMESTAMP
- **INDEX**: (item_id, timestamp)

#### 14.1.4 カテゴリテーブル (categories)
- **id**: INTEGER PRIMARY KEY
- **name**: VARCHAR(100) NOT NULL
- **parent_id**: INTEGER REFERENCES categories(id)
- **site**: VARCHAR(20) NOT NULL（'amazon'/'rakuten'/'both'）
- **url_path**: VARCHAR(255)
- **active**: BOOLEAN DEFAULT TRUE
- **INDEX**: (parent_id)

#### 14.1.5 統計テーブル (item_statistics)
- **id**: INTEGER PRIMARY KEY
- **item_id**: INTEGER REFERENCES items(id)
- **avg_price**: FLOAT
- **min_price**: FLOAT
- **max_price**: FLOAT
- **price_volatility**: FLOAT（価格変動の標準偏差）
- **last_discount_date**: DATETIME
- **discount_frequency**: INTEGER（過去3ヶ月の値下げ回数）
- **updated_at**: DATETIME
- **UNIQUE**: (item_id)

#### 14.1.6 スクレイピングログテーブル (scraping_logs)
- **id**: INTEGER PRIMARY KEY
- **site**: VARCHAR(20) NOT NULL
- **category_id**: INTEGER
- **status**: VARCHAR(20) NOT NULL（'success'/'error'/'warning'）
- **items_processed**: INTEGER
- **items_added**: INTEGER
- **items_updated**: INTEGER
- **price_changes_detected**: INTEGER
- **error_message**: TEXT
- **execution_time**: FLOAT（秒単位）
- **timestamp**: DATETIME DEFAULT CURRENT_TIMESTAMP
- **INDEX**: (site, timestamp)

### 14.2 データ保持ポリシー
- **ランキング商品**: 3ヶ月間ランキング圏外でもデータ保持、以降は非アクティブ化
- **通常商品**: 6ヶ月間情報取得できない場合、非アクティブ化
- **値下げ頻度の高い商品**: 1年以上アクティブ維持
- **価格履歴**: すべての商品について1年間保持、その後圧縮保存
- **通知履歴**: 3ヶ月間保持、その後アーカイブ

### 14.3 データ関連機能
- **自動バックアップ**: 日次SQLダンプ、週次フルバックアップ
- **データ整合性チェック**: 週次で実行、異常データの検出と修正
- **データ集計処理**: 日次で統計テーブル更新
- **古いデータのアーカイブ**: 月次で実行

### 14.4 データベース最適化
- **インデックス戦略**: 頻繁に検索されるカラムにインデックス設定
- **クエリキャッシュ**: 共通クエリの結果をキャッシュ
- **接続プール**: 同時接続数を最適化
- **定期メンテナンス**: 月次でVACUUMとANALYZE実行

## 15. 管理ダッシュボード詳細設計【新規追加】

### 15.1 ダッシュボード構成
- **概要パネル**: スクレイピング状況、通知数、エラー数の概要
- **統計パネル**: 商品数、価格履歴数、通知数の集計
- **最新アクティビティ**: 直近のスクレイピング結果、価格変動、通知

### 15.2 スクレイパー管理画面
- **サイト別制御**: Amazon/楽天ごとの実行/停止
- **カテゴリ別制御**: カテゴリごとの実行/停止
- **スケジュール管理**: 実行スケジュールの表示と編集
- **設定管理**: リクエスト間隔、User-Agent、値引き閾値などの編集
- **ログ表示**: 実行ログのリアルタイム表示と検索

### 15.3 商品管理画面
- **商品検索**: 名前、ID、カテゴリによる絞り込み
- **商品一覧**: 登録商品の一覧表示と詳細表示
- **商品編集**: 商品情報の手動編集
- **商品追加**: 新規商品の手動追加
- **商品削除/非アクティブ化**: 不要商品の管理

### 15.4 通知管理画面
- **通知履歴**: 過去の通知一覧と詳細表示
- **通知設定**: 通知条件（割引率、買い時スコアなど）の設定
- **通知テンプレート**: Twitterなど各プラットフォーム用テンプレート編集
- **手動通知**: 特定商品の手動通知機能

### 15.5 レポート画面
- **日次レポート**: 1日の活動サマリー
- **週次レポート**: 週間の統計と傾向
- **月次レポート**: 月間のパフォーマンス指標
- **カスタムレポート**: 期間と指標を選択してレポート生成